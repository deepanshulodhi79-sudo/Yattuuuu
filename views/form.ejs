<!DOCTYPE html>
<html>
<head>
  <title>Bulk Mail Sender</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="p-3">
  <h2>Bulk Mail Sender</h2>

  <form id="mailForm">
    <div class="mb-2">
      <label>First Name (Sender Name)</label>
      <input type="text" name="senderName" class="form-control" required>
    </div>
    <div class="mb-2">
      <label>Sent From (your sender email)</label>
      <input type="email" name="senderEmail" class="form-control" required>
    </div>
    <div class="mb-2">
      <label>App Password</label>
      <input type="password" name="appPassword" class="form-control">
    </div>
    <div class="mb-2">
      <label>Subject</label>
      <input type="text" name="subject" class="form-control" required>
    </div>
    <div class="mb-2">
      <label>Body</label>
      <textarea name="body" rows="5" class="form-control" required></textarea>
    </div>
    <div class="mb-2">
      <label>Bulk Mails (one per line or comma separated)</label>
      <textarea name="recipients" id="recipients" rows="5" class="form-control" required></textarea>
      <small id="countText"></small>
    </div>
    <button class="btn btn-success">Send</button>
  </form>

  <script>
    // recipient count update
    document.getElementById('recipients').addEventListener('input', function(){
      const all = this.value.split(/[\n,]+/).map(r=>r.trim()).filter(r=>r);
      document.getElementById('countText').innerText = `${all.length} recipient mail addresses are entered`;
    });

    // AJAX submit
    document.getElementById('mailForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);
      const obj = {};
      data.forEach((v,k)=>obj[k]=v);
      try {
        const resp = await fetch('/send', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(obj)
        });
        const result = await resp.json();
        alert(result.message);
        // fields जस के तस रहेंगे (form reset नहीं होगा)
      } catch(err){
        alert("❌ Error sending mails");
      }
    });
  </script>
</body>
</html>
