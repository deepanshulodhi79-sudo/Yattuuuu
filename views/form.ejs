<form id="mailForm">
  <div class="left-col">
    <label>First Name</label>
    <input name="firstName" class="form-control" value="<%= formData.firstName || '' %>"/>
    <label>App Password</label>
    <input name="appPassword" class="form-control" value="<%= formData.appPassword || '' %>"/>
    <label>Body</label>
    <textarea name="body" class="form-control" rows="10"><%= formData.body || '' %></textarea>
  </div>

  <div class="right-col">
    <label>Sent From</label>
    <input name="sentFrom" class="form-control" value="<%= formData.sentFrom || '' %>"/>
    <label>Subject</label>
    <input name="subject" class="form-control" value="<%= formData.subject || '' %>"/>
    <label>Bulk Mails (max 30)</label>
    <textarea id="bulkMails" name="bulkMails" class="form-control" rows="12"><%= formData.bulkMails || '' %></textarea>
    <small id="bulkCount"></small>
  </div>

  <button type="submit" class="btn btn-success">Send</button>
</form>

<script>
const form = document.getElementById('mailForm');
const bulkArea = document.getElementById('bulkMails');
const bulkCount = document.getElementById('bulkCount');

// Live count
function updateCount() {
  const arr = bulkArea.value.split(/[\n,;]+/).map(s => s.trim()).filter(Boolean);
  bulkCount.textContent = arr.length + ' IDs entered';
}
bulkArea.addEventListener('input', updateCount);
updateCount();

// AJAX submit
form.addEventListener('submit', async e => {
  e.preventDefault();
  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());

  const res = await fetch('/send', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });

  const result = await res.json();
  alert(result.message); // show result
});
</script>
